extends ./../_layout/_page_session.pug

block session 
    include ./../_config/_session-check_staff.pug


block title
    section.section__odd
        div.cpnt_title__border
            div.inner_ttlbd__hrzn
                h1 スタッフデータ修正 確認画面
            

block content
    section.section__even
        . 
            <?php

                require_once('../common/functions/sanitize.php');

                $post=sanitize($_POST);
                $staff_code=$post['code'];
                $staff_name=$post['name'];
                $staff_email=$post['email'];
                $staff_pass=$post['pass'];
                $staff_pass2=$post['pass2'];

                $errors = [];

                if($staff_name=='')
                {
                    $errors[] ='適切なスタッフ名が入力されていません。<br/>';
                }
                else 
                {
                    echo 'スタッフ名：';
                    echo htmlspecialchars($staff_name, ENT_QUOTES, 'UTF-8');
                    echo '<br/>';
                }

                if (!filter_var($staff_email, FILTER_VALIDATE_EMAIL)) {
                    $errors[] = '適切なメールアドレスが入力されていません。<br/>';
                } else {
                    echo 'メールアドレス：';
                    echo htmlspecialchars($staff_email, ENT_QUOTES, 'UTF-8');
                    echo '<br/>';
                }

                if($staff_pass=='')
                {
                    echo '適切なパスワードが入力されていません。<br/>';
                }
                if($staff_pass!=$staff_pass2)
                {
                    echo 'パスワードが一致しません。<br/>';
                }

                if(!empty($errors))
                {
                    foreach ($errors as $error) 
                    {
                        echo $error;
                    }
                    echo '<form class="form_contact">';
                    echo '<input type="button" onclick="history.back()" value="戻る" class="dta_select">';
                    echo '</form>';
                }
                else 
                {
                    $staff_pass=password_hash($staff_pass, PASSWORD_DEFAULT);
                    echo '<form method="post" action="./staff_edit_done.php" class="form_contact">';
                    echo '<input type="hidden" name="code" value="'. $staff_code .'" class="dta_select">';
                    echo '<input type="hidden" name="name" value="' . htmlspecialchars($staff_name, ENT_QUOTES, 'UTF-8') . '" class="dta_input">';
                    echo '<input type="hidden" name="email" value="' . htmlspecialchars($staff_email, ENT_QUOTES, 'UTF-8') . '" class="dta_input">';
                    echo '<input type="hidden" name="pass" value="'. $staff_pass .'" class="dta_input">';
                    echo '<br/>';
                    echo '<input type="button" onclick="history.back()" value="戻る" class="dta_select">';
                    echo '<input type="submit"  value="登録" class="dta_select">';
                    echo '</form>';
                }

            ?>

